<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="google-signin-client_id" content="102498965997-1id4r28grqs9dm5agkovm8umc0k7eekd.apps.googleusercontent.com">
	<!-- 266921164837-aoqfrqk0tmgoarlk2gdqmgh2u4khp5u0.apps.googleusercontent.com live-->
	
    <!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
	
	<!-- Custom Css -->
	<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/style-for-payments.css') }}">
	
	<!-- Fontawesome JS-->
	<script src="https://kit.fontawesome.com/7c51f3f017.js" crossorigin="anonymous"></script>
	
	<script>
    function onSuccess(googleUser) {
		console.log(googleUser.getBasicProfile());
		$("#sender-img").attr("src",googleUser.getBasicProfile().getImageUrl());
		document.getElementById('google-input').checked = true;
		$.ajax({
			type: "POST",
			url: "{{url_for('connect_google_openid_session')}}",
			contentType: "application/json",
			data: JSON.stringify(googleUser.getBasicProfile()),
			dataType: "json",
			success: function(response) {
			console.log(response);
			},
			error: function(err) {
			console.log(err);}});
		document.getElementById('paypal-button').removeAttribute("hidden");
    }
    function onFailure(error) {
      console.log(error);
    }
    function renderButton() {
      gapi.signin2.render('my-signin2', {
        'scope': 'openid profile',
        'width': 240,
        'height': 50,
        'longtitle': true,
        'theme': 'dark',
        'onsuccess': onSuccess,
        'onfailure': onFailure
      });
    }
	</script>
	
	<!-- PayPal js -->
	<script src="https://www.paypalobjects.com/api/checkout.js"></script>
	<script>
	paypal.Button.render({
	style: {
	size: 'medium',
	shape: 'rect',
	},
	env: 'sandbox', // Or 'production'
	// Set up the payment:
	// 1. Add a payment callback
	payment: function(data, actions) {
	// 2. Make a request to your server
	return actions.request.post("{{url_for('set_express_checkout')}}", {total:'35.00'})
	.then(function(res) {
	// 3. Return res.id from the response
	return res.paymentID;
	});
	},
	// Execute the payment:
	// 1. Add an onAuthorize callback
	onAuthorize: function(data, actions) {
	// 2. Make a request to your server
	return actions.request.post("{{url_for('do_express_checkout')}}", {
	paymentID: data.paymentID,
	payerID:   data.payerID
	})
	.then(function(res) {
	console.log(res)
	// 3. Show the buyer a confirmation message.
	document.getElementById('paypal-input').checked = true;
	document.getElementById('my-finished').removeAttribute("hidden");
	setTimeout(function(){
	window.location.href = "{{url_for('payments_complete')}}";
	}, 15000);
	});
	}
	}, '#paypal-button');
	</script>
    <title>payments.html</title>
  </head>
  <body>

	<div class="container-fluid p-0">
		<div class="d-flex justify-content-center row">
		<div class="col-md-6">
		<div class="p-4 bg-white notes">
		<div class="d-flex flex-row align-items-center notes-title">
		<h4>Processing Payment Instantly</h4><span class="px-2 review-text ml-2 rounded">secure</span>
		</div>
		
		</div>
		<div class="row">
		<div class="input-group mb-3">
			<input disabled="disabled" id="google-input" type="checkbox" class="option-input radio">
			<div class="input-group-append">
			<div class="label-text"><div id="my-signin2"></div></div>
			</div>
		</div>
		</div>
		<div class="row">
		<div class="input-group mb-3 paypal-row">
			<input disabled="disabled" id="paypal-input" type="checkbox" class="option-input radio">
			<div class="input-group-append">
			<div class="label-text"><div hidden="hidden" id="paypal-button" style="width:240px"></div></div>
			</div>
		</div>
		<div class="input-group mb-3">
		<span class="label-text informational">if you don't have a PayPal account, you can create a new one before you pay. If you don't want to create an account, you can pay using a debit or credit card.</span>
		</div>
		</div>
		<div class="row">
		<div class="input-group mb-3" hidden="hidden">
			<div id="my-finished">
			<a class="btn btn-primary" href="{{url_for('payments_complete')}}" role="button">finish</a>
			</div>
		</div>
		</div>
		<div class="p-2 bg-white">
		<h6 class="line-text"><span>Arpeggio</span></h6>
		</div>
		<div class="d-flex justify-content-center p-2 bg-white user-images">
		<img class="rounded-circle" id="sender-img" src="" width="40">
		<i width="40" class="fas fa-random circle-icon rounded-circle"></i>
		<i width="40" class="fas fa-file-invoice circle-icon rounded-circle recipient"></i>
		</div>
		</div>
		</div>
	</div>
	
	<!-- ajax call cannot with minified/slim jquery -->
	<!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script> -->
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous"></script>
    -->
	<script src="{{ url_for('static',filename='scripts/view-for-payments.js') }}"></script>
	
	<!-- Google OpenID js -->
	<script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>
  </body>
</html>